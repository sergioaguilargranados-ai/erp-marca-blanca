# ðŸ› ï¸ STACK TECNOLÃ“GICO COMPLETO

## ðŸ“ ARQUITECTURA GENERAL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FRONTEND (Next.js)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Super Admin  â”‚  â”‚ ERP Clientes â”‚  â”‚ E-commerceâ”‚ â”‚
â”‚  â”‚ admin.dom.comâ”‚  â”‚empresa1.d.comâ”‚  â”‚ tienda.*  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          BACKEND (Next.js API Routes)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Server   â”‚  â”‚   API    â”‚  â”‚   Webhooks       â”‚  â”‚
â”‚  â”‚ Actions  â”‚  â”‚  Routes  â”‚  â”‚ (Stripe, etc.)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        SERVICIOS EXTERNOS & BASE DE DATOS           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Neon   â”‚  â”‚NextAuth  â”‚  â”‚   Cloudinary     â”‚  â”‚
â”‚  â”‚PostgreSQLâ”‚  â”‚   Auth   â”‚  â”‚    (ImÃ¡genes)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Stripe  â”‚  â”‚  Mercado â”‚  â”‚   Facturama      â”‚  â”‚
â”‚  â”‚   Pagos  â”‚  â”‚   Pago   â”‚  â”‚   (CFDI 4.0)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  OpenAI  â”‚  â”‚ WhatsApp â”‚  â”‚     Resend       â”‚  â”‚
â”‚  â”‚ Chatbot  â”‚  â”‚Business  â”‚  â”‚     (Email)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¨ FRONTEND

### Core Framework
```json
{
  "next": "^14.2.0",
  "react": "^18.2.0",
  "react-dom": "^18.2.0",
  "typescript": "^5.3.0"
}
```

### UI & Styling
```json
{
  "tailwindcss": "^3.3.2",
  "@tailwindcss/forms": "^0.5.7",
  "shadcn/ui": "latest",
  "lucide-react": "^0.294.0",
  "class-variance-authority": "^0.7.0",
  "clsx": "^2.0.0",
  "tailwind-merge": "^2.0.0"
}
```

### State Management
```json
{
  "zustand": "^4.4.7",
  "@tanstack/react-query": "^5.8.0"
}
```
- **Zustand:** Estado global simple y rÃ¡pido
- **React Query:** Cache de datos, sincronizaciÃ³n server

### Forms & Validation
```json
{
  "react-hook-form": "^7.48.2",
  "zod": "^3.22.4",
  "@hookform/resolvers": "^3.3.2"
}
```

### Charts & VisualizaciÃ³n
```json
{
  "recharts": "^2.10.0",
  "date-fns": "^2.30.0"
}
```

### PWA & Offline
```json
{
  "next-pwa": "^5.6.0",
  "idb": "^8.0.0",
  "workbox-window": "^7.0.0"
}
```
- **next-pwa:** ConfiguraciÃ³n automÃ¡tica de Service Workers
- **idb:** IndexedDB wrapper para cachÃ© local
- **workbox:** Estrategias de cachÃ© offline

---

## âš™ï¸ BACKEND

### Next.js Features
- **App Router** (Next.js 14+)
- **Server Actions** para mutaciones
- **API Routes** para endpoints REST
- **Middleware** para multi-tenancy (detecciÃ³n subdominio)

### Database Client
```json
{
  "@neondatabase/serverless": "^0.9.0",
  "drizzle-orm": "^0.29.0",
  "drizzle-kit": "^0.20.0"
}
```
- **Drizzle ORM:** TypeScript-first, excelente con Neon
- **Alternativa:** Prisma (mÃ¡s popular pero menos performante)

**Â¿Por quÃ© Drizzle?**
- âœ… Serverless-friendly (Neon optimizado)
- âœ… TypeScript nativo
- âœ… Queries SQL directos cuando necesites
- âœ… Migrations automÃ¡ticas
- âœ… Mejor performance que Prisma

### AutenticaciÃ³n
```json
{
  "next-auth": "^5.0.0",
  "@auth/drizzle-adapter": "^0.7.0",
  "bcryptjs": "^2.4.3",
  "jose": "^5.1.0"
}
```
- **NextAuth v5 (Auth.js):** Multi-provider, sessions, JWT
- **Soporte:** Email/Password, OAuth (Google, etc.)

### EncriptaciÃ³n
```json
{
  "crypto-js": "^4.2.0"
}
```
- Para credenciales Facturama encriptadas

---

## ðŸ’¾ BASE DE DATOS

### Neon PostgreSQL

**ConexiÃ³n:**
```typescript
import { neon } from '@neondatabase/serverless'

const sql = neon(process.env.DATABASE_URL!)
```

**Row Level Security (RLS):**
```sql
-- Habilitar RLS en todas las tablas multi-tenant
ALTER TABLE productos ENABLE ROW LEVEL SECURITY;

CREATE POLICY tenant_isolation ON productos
  USING (empresa_id = current_setting('app.empresa_id')::uuid);
```

**Backups:**
- Neon ofrece backups automÃ¡ticos
- Configurar retenciÃ³n de 7 dÃ­as (gratis)
- Para 90 dÃ­as: implementar sistema propio

---

## ðŸ’³ PAGOS

### Stripe
```json
{
  "stripe": "^14.7.0",
  "@stripe/stripe-js": "^2.2.0"
}
```

**Funcionalidades:**
- Suscripciones recurrentes (mensual/anual)
- Webhooks para eventos de pago
- Customer Portal para gestiÃ³n de suscripciÃ³n
- Multi-currency (MXN, USD)

### Mercado Pago
```json
{
  "mercadopago": "^2.0.0"
}
```

**Funcionalidades:**
- Alternativa para mercado LATAM
- Checkout Pro
- Webhooks de notificaciÃ³n

---

## ðŸ§¾ FACTURACIÃ“N ELECTRÃ“NICA

### Facturama API
```json
{
  "axios": "^1.6.2"
}
```

**IntegraciÃ³n:**
- API REST de Facturama
- CFDI 4.0
- Timbrado automÃ¡tico
- Webhooks para actualizaciÃ³n de estado

**Endpoints:**
```
POST /api/3/cfdis
GET /api/3/cfdis/{id}
DELETE /api/3/cfdis/{id} (cancelaciÃ³n)
```

---

## ðŸ“§ EMAILS

### Resend
```json
{
  "resend": "^2.1.0",
  "@react-email/components": "^0.0.12"
}
```

**Â¿Por quÃ© Resend?**
- âœ… DiseÃ±ado para Next.js
- âœ… Templates React
- âœ… 3,000 emails gratis/mes
- âœ… Excelente deliverability

**Templates necesarios:**
- Bienvenida
- VerificaciÃ³n de email
- Recordatorio de pago
- Factura generada
- SuspensiÃ³n de cuenta
- RecuperaciÃ³n de contraseÃ±a

---

## ðŸ–¼ï¸ STORAGE DE IMÃGENES

### Cloudinary
```json
{
  "cloudinary": "^1.41.0",
  "next-cloudinary": "^5.11.0"
}
```

**Â¿Por quÃ© Cloudinary?**
- âœ… OptimizaciÃ³n automÃ¡tica de imÃ¡genes
- âœ… Transformaciones on-the-fly
- âœ… CDN global
- âœ… 25GB gratis/mes
- âœ… Upload widget React

**Uso:**
- Logos de empresas
- ImÃ¡genes de productos
- Fotos de inventario desde mÃ³vil

---

## ðŸ¤– CHATBOT IA

### OpenAI API
```json
{
  "openai": "^4.20.0"
}
```

**Modelo recomendado:**
- **GPT-4-turbo** para soporte complejo
- **GPT-3.5-turbo** para respuestas rÃ¡pidas

**Funcionalidades:**
- Chat en vivo con IA
- Respuestas desde base de conocimientos
- IntegraciÃ³n con tickets de soporte

### WhatsApp Business API
```json
{
  "@whiskeysockets/baileys": "^6.5.0"
}
```
**Alternativas:**
- **Twilio WhatsApp API** (mÃ¡s fÃ¡cil, de pago)
- **Baileys** (gratis, mÃ¡s complejo)

---

## ðŸ“± PWA & OFFLINE

### Service Workers
```javascript
// next.config.js
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development',
})

module.exports = withPWA({
  // config
})
```

### IndexedDB (CachÃ© Local)
```typescript
import { openDB } from 'idb'

const db = await openDB('erp-offline', 1, {
  upgrade(db) {
    db.createObjectStore('productos')
    db.createObjectStore('ventas')
    db.createObjectStore('clientes')
    db.createObjectStore('inventario')
  },
})
```

### SincronizaciÃ³n
```typescript
// Background Sync API
if ('serviceWorker' in navigator && 'sync' in registration) {
  registration.sync.register('sync-ventas')
}
```

---

## ðŸ–¨ï¸ IMPRESIÃ“N

### Tickets TÃ©rmicos
```json
{
  "jspdf": "^2.5.1",
  "html2canvas": "^1.4.1"
}
```

**Opciones:**
1. **PDF + Print API** (navegador)
2. **ESC/POS commands** (impresoras tÃ©rmicas directas)

### CÃ³digos de Barras
```json
{
  "jsbarcode": "^3.11.5",
  "react-barcode": "^1.4.6"
}
```

**Formatos soportados:**
- EAN-13
- CODE128
- QR Code

---

## ðŸ“Š REPORTES

### Excel Export
```json
{
  "xlsx": "^0.18.5",
  "exceljs": "^4.4.0"
}
```

### PDF Export
```json
{
  "jspdf": "^2.5.1",
  "jspdf-autotable": "^3.8.2"
}
```

---

## ðŸ” SEGURIDAD

### Rate Limiting
```json
{
  "@upstash/ratelimit": "^1.0.0",
  "@upstash/redis": "^1.25.0"
}
```

### CSRF Protection
- Next.js tiene protecciÃ³n nativa en Server Actions

### Helmet (Headers de seguridad)
```json
{
  "helmet": "^7.1.0"
}
```

---

## ðŸ“¦ UTILIDADES

### General
```json
{
  "lodash": "^4.17.21",
  "dayjs": "^1.11.10",
  "uuid": "^9.0.1",
  "nanoid": "^5.0.4"
}
```

### ValidaciÃ³n
```json
{
  "validator": "^13.11.0"
}
```

### Testing (Opcional para despuÃ©s)
```json
{
  "vitest": "^1.0.0",
  "playwright": "^1.40.0",
  "@testing-library/react": "^14.1.2"
}
```

---

## ðŸŒ MULTI-TENANT

### Middleware de Subdominio
```typescript
// middleware.ts
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

export function middleware(request: NextRequest) {
  const hostname = request.headers.get('host')
  const subdomain = hostname?.split('.')[0]

  if (subdomain === 'admin') {
    // Panel Super Admin
    return NextResponse.rewrite(new URL('/admin', request.url))
  }

  // ERP de empresa
  const response = NextResponse.next()
  response.headers.set('x-tenant', subdomain)
  return response
}
```

---

## ðŸ“± E-COMMERCE (Parte del mismo proyecto)

### Componentes especÃ­ficos
```json
{
  "@stripe/stripe-js": "^2.2.0",
  "swiper": "^11.0.5",
  "react-image-gallery": "^1.3.0"
}
```

### Shopping Cart
```typescript
// Zustand store para carrito
import create from 'zustand'
import { persist } from 'zustand/middleware'

export const useCartStore = create(
  persist(
    (set) => ({
      items: [],
      addItem: (item) => set((state) => ({
        items: [...state.items, item]
      })),
      // ...
    }),
    { name: 'cart-storage' }
  )
)
```

---

## ðŸš€ DEPLOYMENT

### Plataforma Recomendada: Vercel
```json
{
  "vercel": "^32.5.0"
}
```

**Â¿Por quÃ© Vercel?**
- âœ… Creadores de Next.js
- âœ… Edge Functions
- âœ… Serverless perfecto para Next.js
- âœ… Subdominios ilimitados
- âœ… SSL automÃ¡tico

**Alternativas:**
- **Netlify** (bueno pero menos optimizado para Next.js)
- **Railway** (si necesitas mÃ¡s control)

### Variables de Entorno
```env
# Database
DATABASE_URL=postgresql://...neon.tech/...

# Auth
NEXTAUTH_SECRET=...
NEXTAUTH_URL=https://tudominio.com

# Stripe
STRIPE_PUBLIC_KEY=pk_...
STRIPE_SECRET_KEY=sk_...
STRIPE_WEBHOOK_SECRET=whsec_...

# Mercado Pago
MP_PUBLIC_KEY=...
MP_ACCESS_TOKEN=...

# Facturama
FACTURAMA_API_URL=https://api.facturama.mx
FACTURAMA_USER=...
FACTURAMA_PASSWORD=...

# Cloudinary
CLOUDINARY_CLOUD_NAME=...
CLOUDINARY_API_KEY=...
CLOUDINARY_API_SECRET=...

# OpenAI
OPENAI_API_KEY=sk-...

# Resend
RESEND_API_KEY=re_...

# WhatsApp (si usas Twilio)
TWILIO_ACCOUNT_SID=...
TWILIO_AUTH_TOKEN=...
TWILIO_WHATSAPP_NUMBER=whatsapp:+...
```

---

## ðŸ“Š MONITOREO

### Analytics
```json
{
  "@vercel/analytics": "^1.1.1",
  "@vercel/speed-insights": "^1.0.2"
}
```

### Error Tracking
```json
{
  "@sentry/nextjs": "^7.85.0"
}
```

### Logs
```json
{
  "pino": "^8.16.2",
  "pino-pretty": "^10.2.3"
}
```

---

## ðŸŽ¯ RESUMEN DEL STACK

| CategorÃ­a | TecnologÃ­a |
|-----------|-----------|
| **Framework** | Next.js 14 + React 18 + TypeScript |
| **UI** | shadcn/ui + TailwindCSS |
| **Database** | Neon PostgreSQL + Drizzle ORM |
| **Auth** | NextAuth.js v5 |
| **State** | Zustand + React Query |
| **Forms** | React Hook Form + Zod |
| **Pagos** | Stripe + Mercado Pago |
| **FacturaciÃ³n** | Facturama API |
| **Storage** | Cloudinary |
| **Emails** | Resend |
| **Chatbot** | OpenAI GPT-4 |
| **WhatsApp** | Twilio WhatsApp API |
| **PWA** | next-pwa + Service Workers |
| **Offline** | IndexedDB (idb) |
| **Deploy** | Vercel |
| **Monitoring** | Sentry + Vercel Analytics |

---

## âœ… VENTAJAS DE ESTE STACK

1. âœ… **Todo TypeScript** - Type safety completo
2. âœ… **Serverless** - Escala automÃ¡ticamente
3. âœ… **Developer Experience** - RÃ¡pido de desarrollar
4. âœ… **Performance** - Edge computing, CDN global
5. âœ… **Moderno** - Ãšltimas tecnologÃ­as 2024-2025
6. âœ… **EconÃ³mico** - Tiers gratuitos generosos
7. âœ… **DocumentaciÃ³n** - Excelente en todos los servicios

---

**Ãšltima actualizaciÃ³n:** Noviembre 22, 2025
